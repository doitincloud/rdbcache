#!/bin/bash
#
# install_service
#
# By Sam Wen @ 02/10/2018
#
##########################

if [ "$(id -u)" -ne 0 ] ; then
  echo "This script must run under root."
  exit 1
fi

if [ -L /etc/init.d/com.doitincloud.rdbcache ]; then
  service com.doitincloud.rdbcache stop
  rm -f /etc/init.d/com.doitincloud.rdbcache
fi

ln -s /opt/com.doitincloud.rdbcache/rdbcache_service /etc/init.d/com.doitincloud.rdbcache

if [ -L /etc/com.doitincloud.rdbcache.conf ]; then
  rm -f /etc/com.doitincloud.rdbcache.conf
fi

if [ -f /var/log/com.doitincloud.rdbcache.log ]; then
  rm -f /var/log/com.doitincloud.rdbcache.log
fi

touch /var/log/com.doitincloud.rdbcache.log
chmod 666 /var/log/com.doitincloud.rdbcache.log

cat <<EOT > /etc/logrotate.d/com.doitincloud.rdbcache
"/var/log/com.doitincloud.rdbcache.log" {
  weekly
  size 512k
  rotate 12
  create 666 root root
  missingok
  compress
  delaycompress
  copytruncate
  notifempty
}
EOT

ln -s /opt/com.doitincloud.rdbcache/application.properties /etc/com.doitincloud.rdbcache.conf

chkconfig --add com.doitincloud.rdbcache

service com.doitincloud.rdbcache start